generator client {
  provider = "prisma-client"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// ****************** GESTION DES USERS PERMISSIONS & ROLES ******************

// implicite relation between Permission and Role
model Permission {
  id          String  @id @default(cuid())
  name        String  @unique
  resource    String
  action      Action
  description String?

  roles  Role[]
  user   User?   @relation(fields: [userId], references: [id])
  userId String?

  @@unique([resource, action])
  @@map("permission")
}

enum Action {
  create
  read
  update
  delete
}

model Role {
  id          String  @id @default(cuid())
  name        String
  description String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  permissions Permission[]
  users       User[]

  @@unique([name])
  @@map("role")
}

model User {
  id           String  @id @default(cuid())
  name         String
  email        String
  password     String
  active       Boolean @default(true)
  isOwner      Boolean @default(false)
  isSuperAdmin Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  roles       Role[]
  permissions Permission[]

  // 

  @@unique([email])
  @@map("user")
}

// ****************** GESTION DES DONNEES DE BASE ******************

model Site {
  id     String  @id @default(cuid())
  name   String
  active Boolean @default(true)

  @@unique([name])
  @@map("site")
}

model Objectif {
  id    String @id @default(cuid())
  annee Int
  mois  Int
  real  Float?

  @@unique([annee, mois])
  @@map("objectif")
}
